#include <stdio.h>

// Kode warna ANSI
#define MERAH "\033[1;31m"
#define BIRU "\033[1;34m"
#define RESET "\033[0m"
#define EMAS "\033[1;33m"

void awalPapan(char papan[6][7]);
void printPapan(char papan[6][7]);
int Jatuh(char papan[6][7], int col, char simbol);
int Menang(char papan[6][7], int col, int row, char simbol);
int Penuh(char papan[6][7]);

int main(){
    char papan[6][7];
    int kondisi=0;
    int giliran=1;

    awalPapan(papan);

    // JUDUL - WARNA EMAS
    printf(EMAS "===== W3LC0M3 T0 C0NN3CT F0UR =====" RESET "\n");
    printf("Pl@y3r 1 : " MERAH "X" RESET "\n");
    printf("Pl@y3r 2 : " BIRU "O" RESET "\n\n");
    printf(EMAS "M@sukk@n N0m0r 1-7 Untuk M3m1l1h K0l0m" RESET "\n");

    while(kondisi == 0){
        char simbol;
        int col;
        printPapan(papan);
        if (giliran == 1) {
            simbol = 'X';
        } else {
            simbol = 'O';
        }
        
        while (1){
            if (giliran == 1) {
                printf("P3m@1n %d (" MERAH "%c" RESET "), p1l1h k0l0m 1-7: ", giliran, simbol);
            } else {
                printf("P3m@1n %d (" BIRU "%c" RESET "), p1l1h k0l0m 1-7: ", giliran, simbol);
            }
            
            if ( scanf("%d", &col) != 1) {
                printf("Inpu+ t1d@k v@l1d\n");
                while (getchar() != '\n');
                continue;
            }
            if (col < 1 || col > 7) {
                printf("Inpu+ H@rus D1@nt@r@ 1-7\n");
                continue;
            }
            break;
        }
        
        col--;
        int row =  Jatuh(papan, col, simbol);
        if (row == -1){
            printf("K0l0m %d p3nuh!\n", col+1);
            continue;
        }
        
        if(Menang(papan, col, row, simbol) == 1){
            printPapan(papan);
            if (giliran == 1) {
                printf(EMAS "\n \nP3m@1n %d (" MERAH "%c" EMAS ") M3n@ng" RESET "\n", giliran, simbol);
            } else {
                printf(EMAS "\n \nP3m@1n %d (" BIRU "%c" EMAS ") M3n@ng" RESET "\n", giliran, simbol);
            }
            kondisi = 1;
        } else if(Penuh(papan) == 1) {
            printPapan(papan);
            printf(EMAS "S3RI! P@p@n p3nuh" RESET "\n");
            kondisi = 1;
        } else {
            if(giliran == 1){
                giliran = 2;
            } else {
                giliran = 1;
            }
        }
    }
    printf(EMAS "   Thx 4 Pl@y1ng" RESET "\n");
    return 0;
}

void awalPapan(char papan[6][7]){
    for(int i = 0; i < 6; i++){
        for(int j = 0; j < 7; j++){
            papan[i][j] = ' ';
        }
    }
}

void printPapan(char papan[6][7]){
    printf("\n");
    for(int i = 0; i < 6; i++){
        for(int j = 0; j < 7; j++){
            printf("| ");
            if (papan[i][j] == 'X') {
                printf(MERAH "%c" RESET, papan[i][j]);
            } else if (papan[i][j] == 'O') {
                printf(BIRU "%c" RESET, papan[i][j]);
            } else {
                printf("%c", papan[i][j]);
            }
            printf(" ");
        }
        printf("|\n");

        if (i < 6){
            for (int j = 0; j < 7; j++){
                printf("+---");
            }
            printf("+\n");
        }
    }
    printf("  1   2   3   4   5   6   7\n");
}

int Jatuh(char papan[6][7], int col, char simbol){
    for (int i = 6 - 1; i >= 0; i--) {
        if (papan[i][col] == ' ') {
            papan[i][col] = simbol;
            return i; 
        }
    }
    return -1;
}

int Menang(char papan[6][7], int col, int row, char simbol){
    int hitung;
    
    // Vertikal
    hitung = 1; 
    
    // Ke atas
    for(int i = row - 1; i >= 0 && papan[i][col] == simbol; i--){
        hitung++;
    }
    // Ke bawah
    for(int i = row + 1; i < 6 && papan[i][col] == simbol; i++){
        hitung++;
    }
    if(hitung >= 4){
        return 1;
    }

    // Horizontal 
    hitung = 1; 
    
    // Ke kiri
    for(int j = col - 1; j >= 0 && papan[row][j] == simbol; j--){
        hitung++;
    }
    // Ke kanan
    for(int j = col + 1; j < 7 && papan[row][j] == simbol; j++){
        hitung++;
    }
    if(hitung >= 4){
        return 1;
    }

    // Diagonal (\)
    hitung = 1;
    
    // Ke kiri atas
    for(int i = row - 1, j = col - 1; i >= 0 && j >= 0 && papan[i][j] == simbol; i--, j--){
        hitung++;
    }
    // Ke kanan bawah
    for(int i = row + 1, j = col + 1; i < 6 && j < 7 && papan[i][j] == simbol; i++, j++){
        hitung++;
    }
    if(hitung >= 4){
        return 1;
    }

    // Diagonal (/)
    hitung = 1;
    
    // Ke kanan atas
    for(int i = row - 1, j = col + 1; i >= 0 && j < 7 && papan[i][j] == simbol; i--, j++){
        hitung++;
    }
    // Ke kiri bawah
    for(int i = row + 1, j = col - 1; i < 6 && j >= 0 && papan[i][j] == simbol; i++, j--){
        hitung++;
    }
    if(hitung >= 4){
        return 1;
    }
    
    return 0;
}

int Penuh(char papan[6][7]){
    for(int i = 0; i < 7;i++){
        if(papan[0][i] == ' '){
            return 0;
        }
    }
    return 1;
}
